<app-modal
  [isOpen]="isOpen"
  [customLayout]="true"
  [backdropClass]="'bg-black/60'"
  [customClass]="'h-[85vh] max-w-[1340px]! bg-[#0f0e13] border border-white/5 rounded-[22px] shadow-2xl flex overflow-hidden'"
  (closed)="close()"
>
  <div slot="custom" class="flex h-full w-full">
    <!-- Sidebar -->
    <aside class="w-72 bg-white/2 border-r border-white/5 flex flex-col overflow-x-hidden">
      <div class="p-8 border-b border-white/5">
        <h2 class="text-2xl font-bold text-white tracking-tight flex items-center gap-3">
          <div
            class="size-8 rounded-lg bg-violet-500/10 flex items-center justify-center text-violet-400"
          >
            <lucide-icon [img]="Settings" [size]="18"></lucide-icon>
          </div>
          Настройки
        </h2>
      </div>

      <nav class="flex-1 p-3 space-y-4 overflow-y-auto overflow-x-hidden custom-scrollbar">
        @for (category of categories; track category.id) {
        <div class="flex flex-col gap-0.5">
          <div class="px-4 py-2 text-xs font-medium text-white/30 uppercase tracking-wide truncate">
            {{ category.label }}
          </div>

          <div class="flex flex-col">
            @for (section of getSectionsForCategory(category.id); track section.id) {
              <a
                [routerLink]="[]"
                [queryParams]="{ section: section.route }"
                queryParamsHandling="merge"
                [class.bg-white/10]="currentSection?.id === section.id"
                [class.text-white/90]="currentSection?.id === section.id"
                [class.opacity-50]="section.disabled"
                [class.cursor-not-allowed]="section.disabled"
                [class.pointer-events-none]="section.disabled"
                class="group flex items-center gap-3 px-4 py-3 rounded-xl text-white/60 hover:text-white hover:bg-white/5 border border-transparent transition-all font-medium relative"
              >
                <lucide-icon
                  [img]="section.icon"
                  [size]="20"
                  class="shrink-0"
                ></lucide-icon>
                <span class="flex-1 min-w-0 truncate whitespace-nowrap">{{ section.label }}</span>
    
                @if (section.badge) {
                <span
                  class="px-2 py-0.5 text-[10px] font-bold text-white/40 bg-white/5 rounded-md uppercase tracking-wider shrink-0"
                >
                  {{ section.badge }}
                </span>
                }
              </a>
              }
          </div>
        </div>
        }
      </nav>

      <div class="p-4 border-t border-white/5">
        <button
          (click)="close()"
          class="w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl text-white/40 hover:text-white hover:bg-white/5 transition-all font-medium group"
        >
          <lucide-icon [img]="LogOut" [size]="18" class="group-hover:-translate-x-1 transition-transform"></lucide-icon>
          Закрыть настройки
        </button>
      </div>
    </aside>

    <!-- Content Area -->
    <main class="flex-1 flex flex-col min-w-0 bg-[#0f0e13]">
      <!-- Header -->
      <div
        class="h-25 px-10 flex items-center justify-between border-b border-white/5 bg-linear-to-b from-white/2 to-transparent"
      >
        @if (currentSection) {
        <div>
          <h3 class="text-2xl font-bold text-white tracking-tight">
            {{ currentSection.title }}
          </h3>
          <p class="text-white/40 text-sm mt-2">
            {{ currentSection.description }}
          </p>
        </div>
        } @else {
        <div>
          <h3 class="text-2xl font-bold text-white tracking-tight">Настройки</h3>
          <p class="text-white/40 text-sm mt-2">Выберите раздел для настройки</p>
        </div>
        }

        <button
          (click)="close()"
          class="size-10 rounded-xl hover:bg-white/5 text-white/40 hover:text-white transition-all flex items-center justify-center"
          title="Закрыть (Esc)"
        >
          <lucide-icon [img]="X" [size]="24"></lucide-icon>
        </button>
      </div>

      <!-- Scrollable Content -->
      <div class="flex-1 overflow-y-auto px-10 py-7 custom-scrollbar">
          @switch (currentSection?.id) {
            @case ('audio') {
              <app-settings-audio />
            }
            @case ('personalization') {
              <app-personalization-settings />
            }
            @default {
              <!-- Fallback or future sections -->
            }
          }
      </div>
    </main>
  </div>
</app-modal>
